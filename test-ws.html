<!DOCTYPE html>
<html>
<head>
    <title>Spot Feed WebSocket Test</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin: 10px 0; }
        .message { margin: 5px 0; padding: 5px; background: #f0f0f0; border-radius: 5px; }
        input, button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>ðŸŽ¯ Spot Feed WebSocket Test</h1>
    
    <div>
        <input type="text" id="token" placeholder="JWT Token" style="width: 400px">
        <input type="text" id="jointId" placeholder="Joint ID" style="width: 300px">
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
    </div>
    
    <div id="status">Not connected</div>
    
    <div id="messages"></div>
    
    <div>
        <input type="text" id="messageInput" placeholder="Type message..." style="width: 500px">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        let ws = null;

        
        function connect() {
    const token = document.getElementById('token').value;
    const jointId = document.getElementById('jointId').value;

    // Send token as query parameter instead of header
    const url = `wss://spot-feed-ttqm.shuttle.app/ws/joint/${jointId}?token=${token}`;

    ws = new WebSocket(url);

    ws.onopen = () => {
        document.getElementById('status').textContent = 'âœ… Connected!';
        document.getElementById('status').style.color = 'green';
    };

    ws.onmessage = (event) => {
        const msg = JSON.parse(event.data);
        addMessage(`${msg.username}: ${msg.content}`, 'received');
    };

    ws.onerror = (error) => {
        console.error('WebSocket error:', error);
        document.getElementById('status').textContent = 'âŒ Error connecting';
        document.getElementById('status').style.color = 'red';
    };

    ws.onclose = () => {
        document.getElementById('status').textContent = 'ðŸ”´ Disconnected';
        document.getElementById('status').style.color = 'orange';
    };
}

        function disconnect() {
            if (ws) {
                ws.close();
            }
        }
        
        function sendMessage() {
            const content = document.getElementById('messageInput').value;
            if (ws && content) {
                ws.send(JSON.stringify({ content }));
                addMessage('You: ' + content, 'sent');
                document.getElementById('messageInput').value = '';
            }
        }
        
        function addMessage(text, type) {
            const div = document.createElement('div');
            div.className = 'message';
            div.textContent = text;
            div.style.background = type === 'sent' ? '#e3f2fd' : '#f0f0f0';
            document.getElementById('messages').appendChild(div);
            document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
        }
        
        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    </script>
</body>
</html>

